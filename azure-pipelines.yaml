---
  pool:
    name: devpool
    vmImage: "ubuntu-22.04"
   
  trigger:
    - srinu
  variables:
    JAVA_HOME_11_X64: '/usr/lib/jvm/java-11-openjdk-amd64'
  resources:
    repositories:
      - repository: Dockerfile
        endpoint: github.com_srinudammalapati
        ref: 'refs/heads/srinu'
        name: srinudammalapati/azuredevops
        type: github    
  stages:
    - stage: build
      jobs:
        - job: imagebuild
          steps:
            - task: Docker@2
              inputs:
                containerRegistry: acr_id
                repository: scr
                command: 'buildAndPush'
                Dockerfile: 'Dockerfile'
                tags: '$(Build.BuildId)'
    - stage: deploy
      jobs: 
        - job: imagedeploy
          steps:
            - task: Kubernetes@1   
              inputs:
                connectionType: Kubernetes Service Connection  
                kubernetesServiceEndpoint: k8s_id
                command: apply
                useConfigurationFile: true
                configurationType: configuration
                configuration: deployments/deployment

         




